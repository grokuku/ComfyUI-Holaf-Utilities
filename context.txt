--- START OF FILE context.txt ---

--- START OF FILE context.txt ---

--- START OF FILE context.txt ---

RÃˆGLES OPÃ‰RATIONNELLES :

1.  **Gestion des fichiers manquants :** Si un fichier mentionnÃ© est nÃ©cessaire Ã  ma comprÃ©hension ou Ã  l'exÃ©cution d'une tÃ¢che mais n'a pas Ã©tÃ© fourni prÃ©cÃ©demment, ne l'invente jamais. Signale-moi qu'il est manquant et que tu as besoin que je te fournisse son contenu.

2.  **Format des modifications de fichiers :**
    *   Lorsqu'une modification est apportÃ©e Ã  un fichier, fournis une commande `sed` pour Git Bash, **en une seule ligne**, permettant d'appliquer ce patch. (encapsuler l'argument de la commande sed dans des guillemets simples (') au lieu de guillemets doubles)
    *   **Condition :** Ne fournis cette commande `sed` que si elle est basique et ne risque pas de generer une erreur.
    *   Dans ce cas (commande `sed` sans risque), ne montre pas les blocs de code modifiÃ©s, donne uniquement la commande `sed`.
    *   **Restriction d'outil :** N'utilise que `sed` pour ces commandes de patch. N'utilise jamais d'autres outils (comme `patch`, `awk`, `tee`, etc.) pour gÃ©nÃ©rer la commande de modification.
    *   **Alternative :** Si la commande `sed` requise (en respectant la contrainte d'une seule ligne) risquerait de ne pas fonctionner correctement, ou si une commande `sed` en une seule ligne n'est pas rÃ©alisable pour la modification demandÃ©e, ne fournis pas de commande. Ã€ la place, donne-moi le contenu intÃ©gral du fichier modifiÃ©.

3.  **Flux de travail sÃ©quentiel :** AprÃ¨s avoir proposÃ© une modification (commande `sed` ou fichier complet) pour un fichier, attends explicitement l'accord de l'utilisateur (et non du LLM) avant de proposer des modifications pour un fichier suivant ou de continuer sur une autre tÃ¢che.

4.  **Principe de moindre intervention :** Ne fais jamais de zÃ¨le. Ne modifie pas des sections de code qui fonctionnent correctement si cela n'est pas explicitement demandÃ© ou absolument nÃ©cessaire pour la tÃ¢che en cours.

5.  **Anticipation des erreurs et suggestion de vÃ©rification :** N'assume pas que les modifications proposÃ©es fonctionneront parfaitement du premier coup. AprÃ¨s avoir proposÃ© une modification, suggÃ¨re briÃ¨vement les points clÃ©s que je devrais vÃ©rifier ou les tests simples que je pourrais effectuer pour m'assurer du bon fonctionnement.

6.  **Noms de fichiers :** Utilise toujours les chemins de fichiers complets (par exemple `js/image_viewer/image_viewer_gallery.js`) et ne les tronque jamais.

7.  **Fichiers complets :** Ne fournis jamais de fichiers partiels ou tronquÃ©s. Si une modification est nÃ©cessaire, donne toujours le contenu intÃ©gral du fichier modifiÃ©, mÃªme pour un seul caractÃ¨re changÃ©.

---
FILE_TREE_ANALYSIS:
# --- Root Directory ---
ðŸ“ holaf_image_viewer_backend/
  > Backend logic for the Image Viewer.
  ðŸ“ routes/
    > Modular API route handlers for the Image Viewer.
    ðŸ“„ __init__.py
      > Empty. Placeholder.
    ðŸ“„ edit_routes.py
      > Handles image editing operations (non-destructive).
      @ POST /holaf/images/save-edits
      @ GET /holaf/images/load-edits
      @ POST /holaf/images/delete-edits
      -> holaf_database, holaf_utils
    ðŸ“„ export_routes.py
      > Prepares and serves image export packages.
      @ POST /holaf/images/prepare-export
      -> FE_PAYLOAD: {paths_canon:[str], export_format:str, include_meta:bool, meta_method:str}
      @ GET /holaf/images/export-chunk
      -> logic.py (for applying edits), holaf_utils
    ðŸ“„ file_ops_routes.py
      > Handles file system operations (delete, restore).
      @ POST /holaf/images/delete
      @ POST /holaf/images/delete-permanently
      @ POST /holaf/images/restore
      @ POST /holaf/images/empty-trashcan
      -> logic.py, holaf_database
    ðŸ“„ image_routes.py
      > [MODIFIED] Core image listing and filtering. Returns the *full* list of image metadata for a given filter, used by the frontend's virtualized scroller.
      @ GET /holaf/images/filter-options
      @ POST /holaf/images/list
      -> logic.py, holaf_database
    ðŸ“„ metadata_routes.py
      > Handles metadata fetching, extraction, and injection.
      @ GET /holaf/images/metadata
      @ POST /holaf/images/extract-metadata
      @ POST /holaf/images/inject-metadata
      -> logic.py, holaf_database, holaf_utils
    ðŸ“„ thumbnail_routes.py
      > [MODIFIED] Manages thumbnail lifecycle. Serves individual thumbnails (`/get_thumbnail_route`), regenerates them (`/regenerate_thumbnail_route`), and accepts non-blocking batch prioritization requests (`/prioritize_thumbnails_route`) via background tasks to pre-warm the cache.
      -> logic.py, holaf_database, holaf_utils
    ðŸ“„ utility_routes.py
      > Misc utility routes for the viewer.
      @ POST /holaf/images/viewer-activity
      -> worker.py
  ðŸ“„ __init__.py
    > Exposes BE functions and routes to the main `__init__.py`. An interface file.
    -> .logic, .routes.*, .worker
  ðŸ“„ logic.py
    > Core image viewer logic (DB sync, metadata extraction, thumbnail creation). Includes `apply_edits_to_image`.
    -> holaf_database, holaf_utils
  ðŸ“„ routes.py
    > [DEPRECATED] Kept for import safety, but logic is moved to `routes/` subdir.
  ðŸ“„ worker.py
    > Background thread for thumbnail generation.
    -> logic, holaf_database, holaf_utils
ðŸ“ js/
  > Frontend assets.
  ðŸ“ css/
    > All CSS files for styling the utilities.
    ðŸ“„ holaf_image_viewer_styles.css
      > Specific styles for the Image Viewer panel (placeholder).
    ðŸ“„ holaf_image_viewer.css
      > [MODIFIED] Main stylesheet for the Image Viewer's internal layout (gallery, panes). Includes animation classes (`.entering`, `.exiting`), gallery layout styles, the `flex-grow: 0` fix for thumbnails, and styles for folder lock icons.
    ðŸ“„ holaf_shared_panel.css
      > [MODIFIED] Core styles for ALL floating panels (drag, resize, header, close button, modals). Includes styles for keyboard-focused dialog items.
    ðŸ“„ holaf_system_monitor_styles.css
      > Styles for the system monitor overlay.
    ðŸ“„ holaf_terminal_styles.css
      > Styles for the Terminal panel (login/setup screens).
    ðŸ“„ holaf_themes.css
      > [CRITICAL] Defines all themes via CSS variables. All other CSS files use these variables.
    ðŸ“„ holaf_toasts.css
      > [NEW] Styles for the non-blocking toast notification system. Uses theme variables.
    ðŸ“„ holaf_utilities.css
      > [DEPRECATED/MERGED] Old monolithic CSS. Now split into component files but might be referenced.
  ðŸ“ image_viewer/
    > Modular JS for the Image Viewer.
    ðŸ“„ image_viewer_actions.js
      > [MODIFIED] Handles user actions (delete, export). Includes logic for the fully keyboard-navigable export dialog. -> image_viewer_state, HolafPanelManager
    ðŸ“„ image_viewer_editor.js
      > [MODIFIED] Controller for the Image Editor sub-panel. Dispatches `holaf-refresh-thumbnail` event on save/reset. Applies preview filters. Subscribes to `imageViewerState`.
    ðŸ“„ image_viewer_gallery.js
      > [MAJOR REFACTOR & FIXED] Implements a high-performance virtualized scroller. Renders only visible items into the DOM. Preserves scroll position on resize. Provides robust functions like `ensureImageVisible` and `alignImageOnExit` to the navigation module.
    ðŸ“„ image_viewer_infopane.js
      > [REFACTORED] Logic for the right-side info panel. Subscribes to and reads `activeImage` from central state.
    ðŸ“„ image_viewer_navigation.js
      > [MAJOR REFACTOR & FIXED] Manages all keyboard input (`handleKeyDown`) and view mode transitions (`handleEscape`). Unifies exit logic from zoom/fullscreen to ensure correct gallery scroll alignment. Triggers UI updates on navigation.
    ðŸ“„ image_viewer_settings.js
      > [REFACTORED] Manages load/save to/from central state and applies themes/panel settings. Maps between flat server config and structured state object.
    ðŸ“„ image_viewer_state.js
      > [MODIFIED] Manages the central state for the Image Viewer (filters, selection, `ui.view_mode`, etc.) using a pub/sub model. Core of the new state-driven architecture. Includes per-folder lock state (`locked_folders`).
    ðŸ“„ image_viewer_ui.js
      > [MODIFIED] Builds the main panel UI structure. Contains listeners for UI controls like thumbnail size/fit toggles. Subscribes to `imageViewerState`. Updated UI for Reset button position & folder actions (added Invert, per-folder SVG lock icons).
  ðŸ“ model_manager/
    > Modular JS for the Model Manager.
    ðŸ“„ model_manager_actions.js -> holaf_panel_manager
    ðŸ“„ model_manager_settings.js -> holaf_panel_manager
    ðŸ“„ model_manager_ui.js -> holaf_panel_manager
    ðŸ“„ model_manager_view.js -> holaf_panel_manager
  ðŸ“„ chart.min.js
    > Chart.js library for the system monitor.
  ðŸ“„ holaf_image_viewer.js
    > [MODIFIED] Main orchestrator for the Image Viewer. Pre-loads image data on startup for instant panel display, initializes all modules, and delegates rendering to the virtualized scroller.
  ðŸ“„ holaf_main.js
    > [CRITICAL] Main FE entry point.
    > Â§ Creates top menu, loads all CSS assets (including `holaf_toasts.css`).
    > Â§ Initializes and exposes `window.holaf.toastManager`.
    -> holaf_toast_manager, holaf_panel_manager, holaf_terminal, etc.
  ðŸ“„ holaf_model_manager.js
    > Main controller for the Model Manager.
    -> holaf_panel_manager, model_manager/*
  ðŸ“„ holaf_monitor.js
    > Controller for the System Monitor overlay.
    -> chart.min.js
  ðŸ“„ holaf_nodes_manager.js
    > Controller for the Nodes Manager.
    -> holaf_panel_manager
  ðŸ“„ holaf_panel_manager.js
    > [MODIFIED] Core FE utility. Creates draggable panels and modals. Exports `HOLAF_THEMES`. Now manages a global dialog state (`dialogState`) and keyboard navigation for generic dialogs.
  ðŸ“„ holaf_settings_manager.js
    > Controller for the global Settings panel.
    -> holaf_panel_manager
  ðŸ“„ holaf_toast_manager.js
    > [NEW & CRITICAL] Manages creation and lifecycle of toast notifications. Exposes global `window.holaf.toastManager`. Applies a default theme to its container to ensure readability.
  ðŸ“„ holaf_terminal.js
    > Main controller for the Terminal.
    -> holaf_panel_manager, xterm.js, xterm-addon-fit.js
  ðŸ“„ xterm-addon-fit.js
    > Add-on for xterm.js to resize the terminal.
  ðŸ“„ xterm.js
    > Core library for the terminal emulation.
ðŸ“ nodes/
  > Custom nodes for ComfyUI, loaded by root `__init__.py`.
  ðŸ“„ holaf_model_manager.py
    > BE logic for the Model Manager (scanning models, DB interaction, deep scan).
    -> holaf_database
  ðŸ“„ holaf_nodes_manager.py
    > BE logic for the Nodes Manager (scanning node folders, git actions, README fetching).
ðŸ“„ __init__.py
  > [CRITICAL] Main extension entry point.
  > Â§ Imports all BE modules.
  > Â§ Initializes DB, Config.
  > Â§ Registers all API routes (@), including critical UI state saving endpoints like `/holaf/image-viewer/save-settings`.
  > Â§ Patches ComfyUI's `SaveImage` for live updates.
  > Â§ Starts background worker threads (thumbnailing, DB sync).
  > Â§ Dynamically loads custom nodes from the `nodes/` directory.
ðŸ“„ __main__.py
  > Standalone utility script to generate a password hash for `config.ini`. Not used by the running server.
ðŸ“„ deepscan.txt
  > Documentation/plan for the "Deep Scan" feature. Not code.
ðŸ“„ holaf_config.py
  > Manages `config.ini` file. Reads/writes settings, including complex ones like filter arrays as JSON strings.
ðŸ“„ holaf_database.py
  > [MODIFIED] Manages the SQLite database. Implements a robust version check (now v6) and migration system. On startup, it verifies the DB schema version, adding new performance indexes (mtime, subfolder, format) as needed.
ðŸ“„ holaf_server_management.py
  > Handles server restart logic.
ðŸ“„ holaf_system_monitor.py
  > BE for the System Monitor. Gets system stats (psutil, nvidia-smi) and serves them via WebSocket (WS).
ðŸ“„ holaf_terminal.py
  > BE for the Terminal. Handles password auth and WebSocket (WS) PTY sessions.
ðŸ“„ holaf_utils.py
  > Shared Python utility functions (sanitization, file chunking, temp dirs).
ðŸ“„ model_types.json
  > Configuration file defining known model types, their folders, and formats. Used by `holaf_model_manager.py`.
ðŸ“„ README.md
  > Main project documentation and security warning.
ðŸ“„ requirements.txt
  > Python package dependencies (`psutil`, `pywinpty`, `aiofiles`).

---
PROJECT_STATE:
  CURRENT_INVESTIGATION:
    - [Performance] Gallery filter is slow with large folder selections (e.g., "All" or "All except one").
      - **Problem Analysis:** Performance logs confirm the primary bottleneck is the backend, specifically the SQL query execution time. When a large number of folders are selected, the query becomes very slow.
        - **Log Data:** Total backend time ~7.9s. Of this, ~5.5s is spent waiting for the database (both COUNT and SELECT queries), and ~2.4s is spent processing the 13k+ rows in Python and serializing to JSON.
        - **Conclusion:** The frontend is not the bottleneck; its JSON parsing time is negligible (<50ms). The problem is the backend's inability to efficiently filter on a large set of `LIKE` conditions and process the massive result set.
      - **Failed Attempts & Learnings:**
        1.  **Temporary Table JOIN:** The hypothesis that using a temporary SQL table would be faster than a long `IN`/`OR` clause was proven incorrect by the logs. The DB query time remained the primary bottleneck.
        2.  **Server-Side Pagination:** This was a catastrophic failure. It did not solve the performance issue (the initial `COUNT(*)` query was still slow) and severely broke the user experience (broken UI, scroll jumping, loss of functionality). This confirms the current architecture relies on having all image metadata available on the client.
      - **Next Step:** Define a new strategy that specifically targets the slow SQL query for large selections, without changing the core FE/BE architecture. The "inversion logic" (`NOT LIKE`) is the most promising candidate.
  ACTIVE_BUGS:
    # (None currently identified)
  IN_PROGRESS:
    # (None currently identified)
  ROADMAP:
    Global:
      - [new_tool, session_log_tool] # Add a new panel to log user and system actions.
      - [backend, periodic_maintenance_worker] # Hourly worker to clean DB and cache.
    ImageViewer:
      - [feature, ui, ancrage_vue_redimensionnement_miniatures] # Ancrer la vue sur l'image sous le curseur lors du redimensionnement des miniatures pour Ã©viter les sauts de dÃ©filement.
      - [feature, ui, ancrage_vue_redimensionnement_fenetre] # Ancrer la vue sur l'image sous le curseur lors du redimensionnement de la fenÃªtre pour maintenir le contexte visuel.
      - [feature, ui, differenciation_visuelle_curseur_selection] # Modifier le style visuel du curseur de l'image active pour le distinguer clairement des miniatures sÃ©lectionnÃ©es.
      - [feature, ui, animated_gallery_filter_transitions] # Implement smooth, animated cross-fade transitions when gallery filters are changed.
      - [feature, ui, gallery_sorting_options] # Implement gallery sorting controls (by name, by date) in both ascending and descending order.
      - [investigation, state, folder_filter_persistence] # Double-check that folder selection state is robustly saved and restored across full application reboots.
      - [tuning, performance, thumbnail_concurrency] # Evaluate the optimal number of simultaneous thumbnail downloads; consider a slight increase from the current 12.
      - [feature, realtime_file_monitoring] # Replace periodic scan with `watchdog` for instant updates.
      - [feature, corrupted_file_management] # Auto-move unreadable images to `output/corrupted`.
      - [feature, implement_slideshow] # Implement a slideshow mode.
    ImageEditor:
      - [feature, ui, editor_operations_tab(toggle_preview,copy_paste)] # Implement the "Operations" tab with toggle preview and copy/paste settings.
      - [feature, feature_crop_expand(canvas,Pillow_backend)]
      - [feature, feature_white_balance_rgb(canvas,Pillow_backend)]
      - [feature, feature_vignette(css,Pillow_backend)]
      - [feature, feature_watermark_overlay]
  COMPLETED_FEATURES:
    - [fix, ui, gallery_empty_state_rendering] # Corrected a critical rendering bug where the gallery would not display images after being emptied (e.g., by deselecting all folders or entering an empty trashcan). The fix prevents the gallery from collapsing and instead displays a persistent placeholder message, ensuring layout stability and allowing for immediate reloading of thumbnails. This resolves both the "select none" and "trashcan" display issues.
    - [fix, ui, thumbnail_slider_realtime_update_fix] # Corrected the thumbnail size slider to provide smooth, real-time gallery resizing. The virtual gallery's layout logic was modified to accept a live size parameter, forcing the grid to recalculate continuously during sliding for a fluid user experience.
    - [fix, navigation, zoom_exit_scroll_alignment] # Re-implemented the intelligent scroll alignment when exiting the zoom/edit view to match the fullscreen exit behavior, ensuring the active image is positioned correctly (top/bottom of the viewport).
    - [fix, navigation, gallery_keyboard_navigation_highlight] # Corrected a regression where the active thumbnail highlight did not update during gallery_keyboard_navigation_highlight.
    - [fix, ui, gallery_fullscreen_icon_click] # Fixed the fullscreen icon on thumbnails not working after virtualization refactor.
    - [fix, navigation, enter_key_opens_edit_view] # Corrected 'Enter' key to open edit/zoom view instead of fullscreen; added 'Ctrl+Enter' as a shortcut for fullscreen.
    - [fix, navigation, zoom_return_scroll_jump] # Returning to gallery after navigating in zoom/edit view now intelligently scrolls (smoothly) to focus on the active image, respecting its position relative to the viewport.
    - [fix, performance, gallery_scroll_optimization] # Optimized thumbnail loading to use a debounced, targeted approach, eliminating request storms on fast scrolls.
    - [fix, ui, gallery_autofill_layout] # Adjusted thumbnail sizing to dynamically fill the entire gallery width, removing empty space.
    - [fix, performance, initial_load_speed] # Corrected logic to properly utilize pre-loaded data, making the initial panel opening near-instantaneous.
    - [feature, ui, dual_scroll_loading_strategy] # Implemented a smarter thumbnail loading strategy: immediate for mouse wheel, debounced for scrollbar dragging.
    - [major_refactor, performance, gallery_virtualization] # Replaced gallery rendering with a high-performance virtualized scroller. This fixes UI freezes with large datasets, provides an instant-response scrollbar, eliminates flicker on scroll, preserves scroll position on resize, and pre-loads data on startup for an instant-on experience. Includes backend and database index optimizations.
    - [feature, backend, db_versioning_and_migration] # Implemented a robust database version check and migration system. On startup, it verifies the DB schema version. If outdated, it safely backs up the old DB, creates a new one with the latest schema, and transfers all compatible data.
    - [fix, performance, gallery_scalability] # Optimized thumbnail loading for massive galleries.
    - [feature, ui, export_dialog_advanced_nav] # AmÃ©lioration de la boÃ®te de dialogue d'exportation avec une navigation 2D complÃ¨te au clavier (boutons radio, cases Ã  cocher).
    - [feature, ui, dialog_keyboard_navigation] # ImplÃ©mentation de la navigation au clavier (flÃ¨ches, EntrÃ©e/Espace) pour tous les boutons des boÃ®tes de dialogue.
    - [fix, ui, focus_steal_on_controls] # Correction du bug oÃ¹ un clic sur un contrÃ´le de l'interface (slider, case Ã  cocher) bloquait les raccourcis clavier de la galerie.
    - [fix, ui, dialog_z_index_fullscreen] # Correction du z-index des boÃ®tes de dialogue pour qu'elles apparaissent toujours au-dessus de la vue plein Ã©cran.
    - [feature, ui, export_unsaved_changes_dialog] # Affiche un dialogue de confirmation pour sauvegarder les modifications avant d'exporter.
    - [fix, ui, search_scope_buttons_unresponsive] # Correction des boutons de portÃ©e de recherche (Name/Prompt/Workflow) qui ne rÃ©pondaient plus au clic lorsqu'il y avait du texte dans la barre de recherche.
    - [fix, ui, editor_visibility_on_click] # Correction du bug qui affichait l'Ã©diteur d'image un clic sur deux depuis la galerie.
    - [fix, ui, filter_label_cleanup] # Suppression du titre redondant "Filters" pour une interface plus Ã©purÃ©e.
    - [fix, ui, scope_buttons_responsive] # Correction des boutons de portÃ©e de recherche pour qu'ils rafraÃ®chissent toujours la galerie et mettent Ã  jour leur Ã©tat visuel.
    - [fix, state, folder_lock_persistence] # L'Ã©tat de verrouillage des dossiers est maintenant sauvegardÃ© et restaurÃ© aprÃ¨s un redÃ©marrage.
    - [fix, ui, editor_previews_on_fullscreen_stale] # Correction des aperÃ§us de l'Ã©diteur en direct en vue plein Ã©cran/zoom pour qu'ils affichaient toujours les effets de l'image active.
    - [feature, ui, folder_filter_enhancements] # Added folder filter enhancements: "Invert" action, per-folder SVG lock icons, and an advanced reset dialog that respects locked folders' state.
    - [fix, ui, gallery_last_row_justification] # Corrected CSS for the last row of thumbnails to prevent stretching.
    - [fix, ui, thumbnail_fit_toggle_immediate_update] # The "Contained" thumbnail view option now applies instantly.
    - [feature, ui, spacebar_to_toggle_selection_in_gallery] # Pressing spacebar on an active thumbnail now toggles its selection state.
    - [fix, ui, actions_target_active_image_in_zoom_view] # Toolbar actions (Delete, Export, etc.) now correctly target the active image in zoom/fullscreen view.
    - [fix, ui, editor_previews_in_fullscreen] # Live edit previews are now correctly applied to the image in fullscreen mode.
    - [fix, ui, thumbnail_refresh_on_edit_save] # Thumbnail in gallery now updates instantly after an edit is saved, using an event-driven approach.
    - [refactor, ui, gallery_differential_rendering] # Replaced full gallery redraws with a non-blocking, differential rendering engine for fluid filter changes.
    - [fix, ui, filter_race_condition] # Implemented a non-blocking request queue (`isLoading`/`isDirty`) to handle rapid filter changes without losing state.
    - [fix, ui, gallery_selection_bug] # Corrected a bug where clicking a thumbnail selected the wrong image after a filter change.
    - [fix, ui, filter_persistence_partial] # Text search and date range filters now correctly restore their state when the panel is reopened.
    - [feature, ui, gallery_empty_on_no_folder_selection] # The gallery now displays no images when no folders are selected, for a more intuitive UX.
    - [feature, ui, editor_save_cancel_and_unsaved_warning] # Implemented Save/Cancel buttons and a warning dialog for unsaved changes during navigation.
    - [feature, backend, thumbnail_regeneration_with_edits] # Implemented backend logic to regenerate thumbnails with edits applied after Save/Reset actions.
    - [feature, state_driven_architecture] # Major refactor to a state-driven FE architecture.
    - [refactor, fix, image_viewer_editor_and_navigation_state] # Decoupled the Editor and Navigation modules from the main controller.
    - [refactor, image_viewer_infopane_state_driven] # Refactored the info pane to subscribe to the central state.
    - [fix, image_viewer_selection_and_state_bug] # Rebuilt gallery selection logic to be fully state-driven and fixed a critical bug in the state manager.
    - [fix, image_viewer_filter_persistence_full] # Corrected BE save/load logic for all filters and fixed FE data parsing.
    - [fix, toast_theming_and_readability] # Corrected toast manager to apply a theme directly.
    - [feature, ui, toasts_notification_system_base] # Initial implementation of the non-blocking toast system.
    - [major_refactor_backend_frontend]
    - [image_editor_base_architecture]
    - [image_viewer_trashcan]
    - [image_viewer_metadata_tools]
    - [image_editor_initial_bugfixes]
    - [thumbnail_cache_system]
    - [fix, export_workflow_save_fails] # Corrected FE/BE data mismatch and added fallback logic.
    - [feature, ui, image_viewer_reset_filters_button] # Added a button to reset all filters to default.
    - [fix, ui, thumbnail_size_realtime_update] # Thumbnail size slider now updates gallery size instantly.
    - [fix, state, folder_filter_visual_restore_on_startup] # Correction de l'Ã©tat visuel des cases Ã  cocher des filtres de dossiers, qui ne reflÃ©tait pas la configuration chargÃ©e lors du premier affichage du panneau. La logique construit dÃ©sormais correctement l'interface des filtres en se basant sur l'Ã©tat central (`imageViewerState`) au lieu d'interroger un DOM encore vide, garantissant la cohÃ©rence visuelle.

--- END OF FILE context.txt ---